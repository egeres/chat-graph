<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chats</title>
    <link rel="stylesheet" href="style_b.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.5.11/split.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@shopify/draggable@1.0.0-beta.8/lib/draggable.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.12.0/d3.js"></script>
</head>
<body>
    
    <div class="container_global">

        <div id="panel_names">
            <div class="row_name"><div class="spann"></div>AAA</div>
            <div class="row_name"><div class="spann"></div>BBB</div>
            <div class="row_name"><div class="spann"></div>CCC</div>
            <div class="row_name"><div class="spann"></div>DDD</div>
        </div>

        <div id="panel_histories">
            <div class="row_graph" style="background-color: olive;"></div>
            <div class="row_graph" style="background-color: orange;">a</div>
            <div class="row_graph" style="background-color: violet;">vv h sd sd sd ds s ds dsddddbhb hjhbjdbj jhbsdjb jsbjbsj h bsjbsjb hjv</div>
            <div class="row_graph" style="background-color: khaki;">c</div>

            <div class="row_timeline"></div>
        </div>

    </div>
</body>

<script>

    function assign_indexes() {

        var array = document.getElementById("panel_names").children;
        for (let index = 0; index < array.length; index++) {
            const element = array[index];
            // console.log(element);
            element.classList.add("index_" + index.toString());
        }

        var array = document.getElementById("panel_histories").children;
        for (let index = 0; index < array.length; index++) {
            const element = array[index];
            // console.log(element);
            element.classList.add("index_" + index.toString());
        }

    }

    assign_indexes()

    function reorder_right_list() {
        console.log("ordering...");

        var list_refrence  = document.getElementById('panel_names');
        var list_histories = document.getElementById('panel_histories');
        
        // Generamos la lista de orders
        var newOrder = [];
        for (let index = 0; index < list_refrence.children.length; index++) {
            const element = list_refrence.children[index];
            // console.log(element.classList[1]);
            newOrder.push( parseInt(element.classList[1].split("_")[1]) )
        }
        // console.log(newOrder);
        var reordered_elements = [];
        for(let i=0;i<newOrder.length;i++){
            // for(let j=0;j<newOrder.length;j++){
            //     if(i==newOrder[j]){ 
            //         list_histories.appendChild(list_histories.children[j]);
            //     break;
            //     }
            // }

            for (let j = 0; j < list_histories.children.length; j++) {
                const element_j = list_histories.children[j];
                // console.log(element_j);
                
                if(element_j.classList.contains("index_" + newOrder[i].toString())   ){ 
                    
                    list_histories.appendChild(list_histories.children[   j   ]);
                    reordered_elements.push(list_histories.children[   j   ])
                }
                
            }
        }

        // Reordenar las cosas que se suelen quedar fuera
        for (let index = 0; index < list_histories.children.length; index++) {
            const element = list_histories.children[index];
            
            // if (! reordered_elements.includes(element)) {
            //     console.log(list_histories.children[ index ]);
            //     list_histories.appendChild(list_histories.children[ index ]);
            // }

            if (element.classList.contains("row_timeline")) {
                list_histories.appendChild(element);
            }
        }


    }

    Split(['#panel_names', '#panel_histories'], {
        sizes: [18, 75],
        // minSize: [50, 800],
        minSize: [10, 10],
        gutterSize: 5,

        
    });

    var listWithHandle = document.getElementById("panel_names");

    Sortable.create(listWithHandle, {
        // sort: false,
        handle: '.spann',
        animation: 200,
        onStart: function () {
            console.log("asdads");
            
        },
        onEnd: function () { reorder_right_list(); }
    });


    function test_graph() {
        

        var square_x      = 10;
        var square_y      = 60;
        var square_margin = 0;
        var scall         = d3.scaleLinear().domain([0,15]).range([1, 0]);

        function getBaseLog(x, y) {
            return Math.log(y) / Math.log(x);
        }

        var svg = d3.select(
            document.getElementById("panel_histories").firstElementChild
        ).append("svg");

        // width  = chartDiv.offsetWidth;
        // height = chartDiv.offsetHeight;
        width  = 300;
        height = 60;
        svg.attr("width", width).attr("height", height);
        var g = svg.append("g").attr("transform", "translate(0, 0)");

        // g.selectAll("foo").data(single_chat_history.chat_messages_1).enter().append("rect")
        g.selectAll("foo").data([0,80,0,100, 1, 1, 3, 4, 6, 8, 0, 0 ,0 , 0,5,6,4,3,5,7,78,4,5, 200, 300, 500, 900, 10]).enter().append("rect")
            .attr("x", function(d, i) { return width - (i + 1) * (square_x+square_margin); } )
            // .attr("y", function(d, i) { return separation + i * (square_size+separation) + index *( margin_streams + 12 * (square_size+separation)); })
            // .attr("y", function(d, i) { return index *( square_1_y+margin_1_y); })
            .attr("y", function(d, i) { return 0; })
            .attr("width" , square_x)
            .attr("height", square_y)
            // .attr("fill", function(d, i) {  return d3.interpolateYlOrRd( 1 - getBaseLog(500, d) )} ); // logaritmic scale
            .attr("fill", function(d, i) {  return d3.interpolateYlOrRd(scall(d))} );
    
        }

    test_graph();

</script>
</html>